import{createStore as X}from"zustand/vanilla";import{applyPatches as $,enablePatches as z,produceWithPatches as K}from"immer";import{subscribeWithSelector as J}from"zustand/middleware";import{immer as Y}from"zustand/middleware/immer";import{shortString as se}from"starknet";import{CairoCustomEnum as I,CairoOption as b,CairoOptionVariant as C}from"starknet";import{CairoCustomEnum as ce,CairoOption as ue,CairoOptionVariant as de,addAddressPadding as le}from"starknet";import{addAddressPadding as me}from"starknet";import{addAddressPadding as ye}from"starknet";var H={withStackTrace:!1},U=(r,e,t=H)=>{let a=e.isOk()?{type:"Ok",value:e.value}:{type:"Err",value:e.error},n=t.withStackTrace?new Error().stack:void 0;return{data:a,message:r,stack:n}};function T(r,e,t,a){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function o(u){try{l(a.next(u))}catch(f){i(f)}}function c(u){try{l(a.throw(u))}catch(f){i(f)}}function l(u){u.done?s(u.value):n(u.value).then(o,c)}l((a=a.apply(r,e||[])).next())})}function D(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],a=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(r){return this instanceof p?(this.v=r,this):new p(r)}function M(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=t.apply(r,e||[]),n,s=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",i),n[Symbol.asyncIterator]=function(){return this},n;function i(d){return function(v){return Promise.resolve(v).then(d,f)}}function o(d,v){a[d]&&(n[d]=function(k){return new Promise(function(q,G){s.push([d,k,q,G])>1||c(d,k)})},v&&(n[d]=v(n[d])))}function c(d,v){try{l(a[d](v))}catch(k){E(s[0][3],k)}}function l(d){d.value instanceof p?Promise.resolve(d.value.v).then(u,f):E(s[0][2],d)}function u(d){c("next",d)}function f(d){c("throw",d)}function E(d,v){d(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function W(r){var e,t;return e={},a("next"),a("throw",function(n){throw n}),a("return"),e[Symbol.iterator]=function(){return this},e;function a(n,s){e[n]=r[n]?function(i){return(t=!t)?{value:p(r[n](i)),done:!1}:s?s(i):i}:s}}function F(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof D=="function"?D(r):r[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(s){t[s]=r[s]&&function(i){return new Promise(function(o,c){i=r[s](i),n(o,c,i.done,i.value)})}}function n(s,i,o,c){Promise.resolve(c).then(function(l){s({value:l,done:o})},i)}}var g=class r{constructor(e){this._promise=e}static fromSafePromise(e){let t=e.then(a=>new h(a));return new r(t)}static fromPromise(e,t){let a=e.then(n=>new h(n)).catch(n=>new m(t(n)));return new r(a)}static fromThrowable(e,t){return(...a)=>new r(T(this,void 0,void 0,function*(){try{return new h(yield e(...a))}catch(n){return new m(t?t(n):n)}}))}static combine(e){return L(e)}static combineWithAllErrors(e){return R(e)}map(e){return new r(this._promise.then(t=>T(this,void 0,void 0,function*(){return t.isErr()?new m(t.error):new h(yield e(t.value))})))}andThrough(e){return new r(this._promise.then(t=>T(this,void 0,void 0,function*(){if(t.isErr())return new m(t.error);let a=yield e(t.value);return a.isErr()?new m(a.error):new h(t.value)})))}andTee(e){return new r(this._promise.then(t=>T(this,void 0,void 0,function*(){if(t.isErr())return new m(t.error);try{yield e(t.value)}catch{}return new h(t.value)})))}orTee(e){return new r(this._promise.then(t=>T(this,void 0,void 0,function*(){if(t.isOk())return new h(t.value);try{yield e(t.error)}catch{}return new m(t.error)})))}mapErr(e){return new r(this._promise.then(t=>T(this,void 0,void 0,function*(){return t.isOk()?new h(t.value):new m(yield e(t.error))})))}andThen(e){return new r(this._promise.then(t=>{if(t.isErr())return new m(t.error);let a=e(t.value);return a instanceof r?a._promise:a}))}orElse(e){return new r(this._promise.then(t=>T(this,void 0,void 0,function*(){return t.isErr()?e(t.error):new h(t.value)})))}match(e,t){return this._promise.then(a=>a.match(e,t))}unwrapOr(e){return this._promise.then(t=>t.unwrapOr(e))}safeUnwrap(){return M(this,arguments,function*(){return yield p(yield p(yield*W(F(yield p(this._promise.then(t=>t.safeUnwrap()))))))})}then(e,t){return this._promise.then(e,t)}[Symbol.asyncIterator](){return M(this,arguments,function*(){let t=yield p(this._promise);return t.isErr()&&(yield yield p(_(t.error))),yield p(t.value)})}};function _(r){return new g(Promise.resolve(new m(r)))}var Z=g.fromPromise,ee=g.fromSafePromise,te=g.fromThrowable,j=r=>{let e=w([]);for(let t of r)if(t.isErr()){e=y(t.error);break}else e.map(a=>a.push(t.value));return e},L=r=>g.fromSafePromise(Promise.all(r)).andThen(j),B=r=>{let e=w([]);for(let t of r)t.isErr()&&e.isErr()?e.error.push(t.error):t.isErr()&&e.isOk()?e=y([t.error]):t.isOk()&&e.isOk()&&e.value.push(t.value);return e},R=r=>g.fromSafePromise(Promise.all(r)).andThen(B),A;(function(r){function e(n,s){return(...i)=>{try{let o=n(...i);return w(o)}catch(o){return y(s?s(o):o)}}}r.fromThrowable=e;function t(n){return j(n)}r.combine=t;function a(n){return B(n)}r.combineWithAllErrors=a})(A||(A={}));function w(r){return new h(r)}function y(r){return new m(r)}var h=class{constructor(e){this.value=e}isOk(){return!0}isErr(){return!this.isOk()}map(e){return w(e(this.value))}mapErr(e){return w(this.value)}andThen(e){return e(this.value)}andThrough(e){return e(this.value).map(t=>this.value)}andTee(e){try{e(this.value)}catch{}return w(this.value)}orTee(e){return w(this.value)}orElse(e){return w(this.value)}asyncAndThen(e){return e(this.value)}asyncAndThrough(e){return e(this.value).map(()=>this.value)}asyncMap(e){return g.fromSafePromise(e(this.value))}unwrapOr(e){return this.value}match(e,t){return e(this.value)}safeUnwrap(){let e=this.value;return(function*(){return e})()}_unsafeUnwrap(e){return this.value}_unsafeUnwrapErr(e){throw U("Called `_unsafeUnwrapErr` on an Ok",this,e)}*[Symbol.iterator](){return this.value}},m=class{constructor(e){this.error=e}isOk(){return!1}isErr(){return!this.isOk()}map(e){return y(this.error)}mapErr(e){return y(e(this.error))}andThrough(e){return y(this.error)}andTee(e){return y(this.error)}orTee(e){try{e(this.error)}catch{}return y(this.error)}andThen(e){return y(this.error)}orElse(e){return e(this.error)}asyncAndThen(e){return _(this.error)}asyncAndThrough(e){return _(this.error)}asyncMap(e){return _(this.error)}unwrapOr(e){return e}match(e,t){return t(this.error)}safeUnwrap(){let e=this.error;return(function*(){throw yield y(e),new Error("Do not use this generator out of `safeTry`")})()}_unsafeUnwrap(e){throw U("Called `_unsafeUnwrap` on an Err",this,e)}_unsafeUnwrapErr(e){return this.error}*[Symbol.iterator](){let e=this;return yield e,e}},re=A.fromThrowable;function N(r){return r instanceof b}function Q(r,e){return e instanceof b&&e.isSome()?new b(C.Some,e.unwrap()):r instanceof b?r.isSome()?new b(C.Some,r.unwrap()):new b(C.None):r}function P(r){return r instanceof I}function V(r,e){if(!P(r)||!P(e))return r;let t=e.activeVariant(),a=e.unwrap();if(t&&a!==void 0){let i={};for(let o in r.variant)i[o]=void 0;return i[t]=a,new I(i)}let n=r.activeVariant(),s=r.unwrap();if(n&&s!==void 0){let i={};for(let o in r.variant)i[o]=void 0;return i[n]=s,new I(i)}return r}function S(r,e){if(N(r)&&N(e))return Q(r,e);if(P(r)&&P(e))return V(r,e);let t={...r};for(let a in e)Object.hasOwn(e,a)&&(e[a]!==null&&typeof e[a]=="object"&&!Array.isArray(e[a])&&a in r&&typeof r[a]=="object"&&!Array.isArray(r[a])?t[a]=S(r[a],e[a]):t[a]=e[a]);return t}z();function x(r,e){return r.entityId===e.entityId&&JSON.stringify(r.models)===JSON.stringify(e.models)}function O(r){let e=r(J(Y((t,a)=>({entities:{},historical_entities:{},pendingTransactions:{},setEntities:n=>{t(s=>{for(let i of n)s.entities[i.entityId]=i})},mergeEntities:n=>{t(s=>{for(let i of n)if(i.entityId&&i.models){let o=s.entities[i.entityId];if(!o){s.entities[i.entityId]=i;continue}let c=Object.assign({},o.models);for(let[l,u]of Object.entries(i.models)){let f=l;f in c||(c[f]={}),c[f]=S(c[f],u)}s.entities[i.entityId]={...o,...i,models:c}}})},updateEntity:n=>{t(s=>{if(n.entityId&&n.models){let i=s.entities[n.entityId];if(!i){s.entities[n.entityId]=n;return}let o=Object.assign({},i.models);for(let[c,l]of Object.entries(n.models)){let u=c;u in o||(o[u]={}),o[u]=S(o[u],l)}s.entities[n.entityId]={...i,...n,models:o}}})},setHistoricalEntities:n=>{t(s=>{for(let i of n){let o=s.historical_entities[i.entityId];if(!o||o.length===0){s.historical_entities[i.entityId]=[i];continue}let c=o[o.length-1];x(i,c)||o.push(i)}})},mergeHistoricalEntities:n=>{t(s=>{for(let i of n)if(i.entityId&&i.models){let o=s.historical_entities[i.entityId];if(!o||o.length===0){s.historical_entities[i.entityId]=[i];continue}let c=o[o.length-1];x(i,c)||o.push(i)}})},updateHistoricalEntity:n=>{t(s=>{if(n.entityId){let i=s.historical_entities[n.entityId];if(!i||i.length===0)s.historical_entities[n.entityId]=[n];else{let o=i[i.length-1];x(n,o)||i.push(n)}}})},applyOptimisticUpdate:(n,s)=>{let i=a(),[o,c,l]=K(i,u=>{s(u)});t(()=>o),t(u=>{u.pendingTransactions[n]={transactionId:n,patches:c,inversePatches:l}})},revertOptimisticUpdate:n=>{let s=a().pendingTransactions[n];s&&(t(i=>$(i,s.inversePatches)),t(i=>{delete i.pendingTransactions[n]}))},confirmTransaction:n=>{t(s=>{delete s.pendingTransactions[n]})},subscribeToEntity:(n,s)=>e.subscribe(i=>{let o=i.entities[n];s(o)}),waitForEntityChange:(n,s,i=6e3)=>new Promise((o,c)=>{let l=a().entities[n];if(s(l)){o(l);return}let u=e.subscribe(E=>{let d=E.entities[n];s(d)&&(clearTimeout(f),u(),o(d))}),f=setTimeout(()=>{u(),c(new Error(`waitForEntityChange: Timeout of ${i}ms exceeded`))},i)}),getEntity:n=>a().entities[n],getEntities:n=>{let s=Object.values(a().entities);return n?s.filter(n):s},getEntitiesByModel:(n,s)=>a().getEntities(i=>!!i.models[n]?.[s]),getHistoricalEntities:n=>a().historical_entities[n]||[],getEntityAtIndex:(n,s)=>{let i=a().historical_entities[n];if(!(!i||s<0||s>=i.length))return i[s]},clearHistoricalEntities:n=>{t(s=>{n?delete s.historical_entities[n]:s.historical_entities={}})},resetStore:()=>{t(n=>{n.entities={},n.historical_entities={},n.pendingTransactions={}})}}))));return e}function Pe(){return O(X)}export{O as a,Pe as b};
//# sourceMappingURL=chunk-UBJGYNFR.js.map